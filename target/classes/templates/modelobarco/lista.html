<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Lista de Modelos de Barco - CRUISEMANAGER</title>

<!-- CSS Libraries -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
/* Variables de colores */
:root {
	--primary-gradient: linear-gradient(90deg, #0d6efd, #20c997);
	--background-gradient: linear-gradient(135deg, #f0f4f9, #d9e4f5);
	--card-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
	--hover-transition: all 0.3s ease-in-out;
}

/* Estilos generales */
body {
	background: var(--background-gradient);
	font-family: "Poppins", sans-serif;
	min-height: 100vh;
}

/* Card principal */
.main-card {
	border-radius: 1.2rem;
	box-shadow: var(--card-shadow);
	overflow: hidden;
	margin-top: 2rem;
	border: none;
}

.card-header-custom {
	background: var(--primary-gradient);
	color: white;
	font-weight: 600;
	letter-spacing: 1px;
	padding: 1rem 1.5rem;
	font-size: 1.3rem;
	border-bottom: none;
}

/* Tabla */
.table-custom thead {
	background: #0d6efd;
	color: white;
}

.table-custom thead th {
	border: none;
	padding: 1rem 0.75rem;
	font-weight: 600;
}

.table-custom tbody tr {
	transition: var(--hover-transition);
}

.table-custom tbody tr:hover {
	background-color: #eef6ff;
	transform: translateY(-1px);
}

.table-custom tbody td {
	padding: 0.75rem;
	vertical-align: middle;
	border-color: #dee2e6;
}

/* Botones */
.btn-custom {
	border-radius: 2rem;
	padding: 0.4rem 1rem;
	font-weight: 500;
	transition: var(--hover-transition);
	border: none;
}

.btn-custom:hover {
	transform: translateY(-2px);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-new {
	background: linear-gradient(45deg, #198754, #20c997);
	color: white;
}

.btn-new:hover {
	background: linear-gradient(45deg, #157347, #1ba87e);
	color: white;
}

/* Búsqueda */
.search-container {
	max-width: 300px;
}

.search-input {
	border-radius: 2rem;
	border: 2px solid #e9ecef;
	padding: 0.5rem 1rem;
	transition: var(--hover-transition);
}

.search-input:focus {
	border-color: #0d6efd;
	box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

/* Alertas */
.alert-custom {
	border-radius: 1rem;
	border: none;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* Responsive */
@media ( max-width : 768px) {
	.card-header-custom {
		flex-direction: column;
		gap: 1rem;
		text-align: center;
	}
	.search-container {
		max-width: 100%;
	}
	.btn-group-responsive {
		display: flex;
		gap: 0.5rem;
	}
	.btn-group-responsive .btn {
		flex: 1;
		font-size: 0.8rem;
		padding: 0.3rem 0.6rem;
	}
}

/* Estados vacíos */
.empty-state {
	text-align: center;
	padding: 3rem 1rem;
	color: #6c757d;
}

.empty-state i {
	font-size: 4rem;
	margin-bottom: 1rem;
	opacity: 0.5;
}

/* Badge para IDs */
.id-badge {
	background: linear-gradient(45deg, #6c757d, #adb5bd);
	color: white;
	border-radius: 1rem;
	padding: 0.25rem 0.75rem;
	font-size: 0.8rem;
	font-weight: 600;
}

/* Mensaje sin datos para DataTables */
.dataTables_empty {
	text-align: center !important;
	padding: 3rem 1rem !important;
}
</style>
</head>
<body>
	<div class="container my-5">
		<!-- Card Principal -->
		<div class="card main-card">
			<!-- Header con título y controles -->
			<div
				class="card-header card-header-custom d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
				<div class="d-flex align-items-center">
					<i class="fas fa-ship me-3"></i>
					<h1 class="h4 mb-0">Lista de Modelos de Barco</h1>
				</div>

				<div
					class="d-flex flex-column flex-sm-row align-items-center gap-2 w-100 w-md-auto">
					<div class="search-container w-100">
						<div class="input-group">
							<span class="input-group-text search-input border-end-0">
								<i class="fas fa-search"></i>
							</span> <input type="text" id="searchInput"
								class="form-control search-input border-start-0"
								placeholder="Buscar modelos...">
						</div>
					</div>
					<a th:href="@{/modelos-barco/nuevo}" class="btn btn-new btn-custom">
						<i class="fas fa-plus me-2"></i>Nuevo Modelo
					</a>
					<a th:href="@{/dashboard}" class="btn btn-warning btn-custom"> 
						<i class="fas fa-sign-out-alt me-2"></i>Regresar
					</a>
				</div>
			</div>

			<!-- Body -->
			<div class="card-body p-4">
				<!-- Estado vacío cuando no hay modelos -->
				<div th:if="${#lists.isEmpty(modelosBarco)}" class="text-center py-5">
					<div class="empty-state">
						<i class="fas fa-ship"></i>
						<h5>No hay modelos de barco registrados</h5>
						<p class="mb-0">Comienza agregando el primer modelo de barco al sistema.</p>
						<a th:href="@{/modelos-barco/nuevo}" class="btn btn-new btn-custom mt-3">
							<i class="fas fa-plus me-2"></i>Crear Primer Modelo
						</a>
					</div>
				</div>

				<!-- Tabla de modelos (solo se muestra si hay datos) -->
				<div th:if="${not #lists.isEmpty(modelosBarco)}" class="table-responsive">
					<table id="tablaModelosBarco"
						class="table table-hover table-custom align-middle">
						<thead>
							<tr>
								<th width="100">ID</th>
								<th>Nombre del Modelo</th>
								<th>Capacidad de Pasajeros</th>
								<th>Total de Camarotes</th>
								<th width="200">Acciones</th>
							</tr>
						</thead>
						<tbody>
							<!-- Lista de modelos -->
							<tr th:each="modelo : ${modelosBarco}">
								<td>
									<span class="id-badge" th:text="${modelo.idModelo}"></span>
								</td>
								<td>
									<i class="fas fa-ship text-primary me-2"></i> 
									<strong th:text="${modelo.nombre}"></strong>
								</td>
								<td>
									<i class="fas fa-users text-success me-2"></i> 
									<span th:text="${modelo.capacidadPasajeros}"></span> pasajeros
								</td>
								<td>
									<i class="fas fa-bed text-info me-2"></i> 
									<span th:text="${modelo.totalCamarotes}"></span> camarotes
								</td>
								<td>
									<div class="btn-group-responsive d-flex flex-nowrap gap-2">
										<a th:href="@{/modelos-barco/editar/{id}(id=${modelo.idModelo})}"
											class="btn btn-primary btn-sm btn-custom flex-fill"
											title="Editar modelo"> 
											<i class="fas fa-edit me-1"></i>Editar
										</a> 
										<a th:href="@{/modelos-barco/eliminar/{id}(id=${modelo.idModelo})}"
											class="btn btn-danger btn-sm btn-custom flex-fill eliminar-btn"
											th:attr="data-modelo-id=${modelo.idModelo}, data-modelo-name=${modelo.nombre}"
											title="Eliminar modelo">
											<i class="fas fa-trash me-1"></i>Eliminar
										</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- JavaScript Libraries -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script
		src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script
		src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

	<script>
		// Función para obtener parámetros de la URL
		function getUrlParameter(name) {
			name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
			var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
			var results = regex.exec(location.search);
			return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
		}

		// Función para confirmar eliminación con SweetAlert
		function confirmarEliminacion(element) {
			const modeloId = element.getAttribute('data-modelo-id');
			const modeloName = element.getAttribute('data-modelo-name');
			const deleteUrl = `/modelos-barco/eliminar/${modeloId}`;
			
			Swal.fire({
				title: '¿Estás seguro?',
				html: `¿Estás seguro de que deseas eliminar el modelo <strong>"${modeloName}"</strong>?<br><br>Esta acción no se puede deshacer.`,
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#d33',
				cancelButtonColor: '#3085d6',
				confirmButtonText: 'Sí, eliminar',
				cancelButtonText: 'Cancelar',
				reverseButtons: true
			}).then((result) => {
				if (result.isConfirmed) {
					window.location.href = deleteUrl;
				}
			});
		}

		// Inicializar DataTables solo si la tabla existe
		$(document).ready(function() {
			// Verificar parámetros de la URL para mostrar alertas
			const okParam = getUrlParameter('ok');
			const errorParam = getUrlParameter('error');

			if (okParam) {
				Swal.fire({
					icon: 'success',
					title: '¡Éxito!',
					text: okParam,
					confirmButtonColor: '#198754',
					timer: 3000,
					timerProgressBar: true,
					didClose: () => {
						// Limpiar parámetro de la URL sin recargar
						const url = new URL(window.location);
						url.searchParams.delete('ok');
						window.history.replaceState({}, '', url);
					}
				});
			}

			if (errorParam) {
				Swal.fire({
					icon: 'error',
					title: 'Error',
					text: errorParam,
					confirmButtonColor: '#dc3545',
					didClose: () => {
						// Limpiar parámetro de la URL sin recargar
						const url = new URL(window.location);
						url.searchParams.delete('error');
						window.history.replaceState({}, '', url);
					}
				});
			}

			const tableElement = document.getElementById('tablaModelosBarco');

			if (tableElement) {
				const table = $('#tablaModelosBarco').DataTable({
					paging: true,
					ordering: true,
					info: true,
					searching: true,
					lengthMenu: [5, 10, 25, 50],
					pageLength: 10,
					dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>rt<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
					language: {
						"search": "Buscar:",
						"lengthMenu": "Mostrar _MENU_ modelos por página",
						"zeroRecords": "No se encontraron modelos que coincidan con la búsqueda",
						"info": "Mostrando _START_ a _END_ de _TOTAL_ modelos",
						"infoEmpty": "No hay modelos disponibles",
						"infoFiltered": "(filtrado de _MAX_ modelos totales)",
						"paginate": {
							"first": "Primero",
							"last": "Último",
							"next": "Siguiente",
							"previous": "Anterior"
						},
						"emptyTable": "No hay modelos registrados en el sistema"
					},
					columnDefs: [{
						orderable: false,
						targets: 4 // Columna de acciones no ordenable
					}],
					drawCallback: function(settings) {
						// Personalizar el mensaje de tabla vacía
						const api = this.api();
						if (api.rows().count() === 0) {
							$('.dataTables_empty').html(
								'<div class="empty-state">' +
								'<i class="fas fa-search"></i>' +
								'<h5>No se encontraron modelos</h5>' +
								'<p class="mb-0">Intenta con otros términos de búsqueda.</p>' +
								'</div>'
							);
						}
						
						// Re-asignar eventos a los botones de eliminar después de que DataTables redibuje la tabla
						$('.eliminar-btn').off('click').on('click', function(e) {
							e.preventDefault();
							confirmarEliminacion(this);
						});
					}
				});

				// Búsqueda personalizada
				$('#searchInput').on('keyup', function() {
					table.search(this.value).draw();
				});
				
				// Asignar eventos a los botones de eliminar
				$('.eliminar-btn').on('click', function(e) {
					e.preventDefault();
					confirmarEliminacion(this);
				});
			}
		});
	</script>
</body>
</html>