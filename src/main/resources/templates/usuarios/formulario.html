<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${usuario.id} != null ? 'Editar Usuario - Sistema de Cruceros' : 'Nuevo Usuario - Sistema de Cruceros'">Formulario Usuario</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: linear-gradient(135deg, #f0f4f9, #d9e4f5); font-family: "Poppins", sans-serif; }
.card { border-radius: 1.2rem; box-shadow: 0 8px 25px rgba(0,0,0,0.08); overflow: hidden; margin-top: 2rem; }
.card-header { background: linear-gradient(90deg, #0d6efd, #20c997); color: white; font-weight: 600; letter-spacing: 1px; padding: 1rem 1.5rem; font-size: 1.3rem; }
.btn-custom { border-radius: 2rem; padding: 0.4rem 1rem; }
.form-label { font-weight: 500; }
</style>
</head>
<body>
<div class="container my-5">
  <div class="card">
    <div class="card-header" th:text="${usuario.id} != null ? '‚úèÔ∏è Editar Usuario - Sistema de Cruceros' : 'üìÑ Nuevo Usuario - Sistema de Cruceros'"></div>
    <div class="card-body p-4">

      <div th:if="${ok}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${ok}">Operaci√≥n realizada con √©xito</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
      <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}">Ocurri√≥ un error</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>

      <div th:if="${usuario != null and usuario.esAdmin}"
           class="alert alert-warning">
        ‚ö†Ô∏è Este es un usuario <strong>Administrador del Sistema</strong>. Tenga precauci√≥n al realizar cambios.
      </div>

      <form th:action="${usuario.id} != null ? @{/usuarios/actualizar/{id}(id=${usuario.id})} : @{/usuarios}"
            th:object="${usuario}"
            method="post"
            class="row g-3"
            novalidate>

        <input type="hidden" th:field="*{id}" />

        <div class="alert alert-danger" th:if="${#fields.hasGlobalErrors()}">
          <ul class="mb-0">
            <li th:each="e : ${#fields.globalErrors()}" th:text="${e}">Error</li>
          </ul>
        </div>

        <!-- Fila 1: Informaci√≥n Personal -->
        <div class="col-md-6">
          <label for="nombreCompleto" class="form-label">Nombre Completo</label>
          <input type="text" th:field="*{nombreCompleto}" class="form-control"
                 th:classappend="${#fields.hasErrors('nombreCompleto')} ? ' is-invalid'" 
                 placeholder="Ej: Juan P√©rez Garc√≠a" required />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('nombreCompleto')}" th:errors="*{nombreCompleto}"></div>
        </div>

        <div class="col-md-6">
          <label for="cargo" class="form-label">Cargo</label>
          <input type="text" th:field="*{cargo}" class="form-control"
                 th:classappend="${#fields.hasErrors('cargo')} ? ' is-invalid'" 
                 placeholder="Ej: Administrador, Gerente, etc." required />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('cargo')}" th:errors="*{cargo}"></div>
        </div>

        <!-- Fila 2: Documentaci√≥n y Contacto -->
        <div class="col-md-6">
          <label for="dui" class="form-label">DUI</label>
          <input type="text" th:field="*{dui}" class="form-control"
                 th:classappend="${#fields.hasErrors('dui')} ? ' is-invalid'"
                 required placeholder="00000000-0" />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('dui')}" th:errors="*{dui}"></div>
        </div>

        <div class="col-md-6">
          <label for="telefono" class="form-label">Tel√©fono</label>
          <input type="text" th:field="*{telefono}" class="form-control"
                 th:classappend="${#fields.hasErrors('telefono')} ? ' is-invalid'"
                 placeholder="Ej: 77778888 (8-15 d√≠gitos)" />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
        </div>

        <!-- Fila 3: Credenciales -->
        <div class="col-md-6">
          <label for="username" class="form-label">Nombre de Usuario</label>
          <input type="text" th:field="*{username}" class="form-control"
                 th:classappend="${#fields.hasErrors('username')} ? ' is-invalid'"
                 required th:readonly="${usuario.esAdmin}" />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
        </div>

        <div class="col-md-6">
          <label for="password" class="form-label">Contrase√±a</label>
          <input type="password" th:field="*{password}" class="form-control"
                 th:placeholder="${usuario.id} != null ? 'Dejar vac√≠o para mantener la actual' : 'M√≠nimo 6 caracteres'"
                 th:attr="required=${usuario.id == null}"
                 th:readonly="${usuario.esAdmin}" />
          <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
        </div>

        <!-- Fila 4: Opciones -->
        <div class="col-md-6 form-check mt-2">
          <input type="checkbox" th:field="*{activo}" class="form-check-input" id="activo">
          <label class="form-check-label" for="activo">Usuario Activo</label>
        </div>

        <div class="col-md-6 form-check mt-2">
          <input type="checkbox" th:field="*{esAdmin}" class="form-check-input" id="esAdmin">
          <label class="form-check-label" for="esAdmin">Administrador del Sistema</label>
        </div>

        <!-- Fila 5: Botones -->
        <div class="col-12 d-flex gap-2 mt-4">
          <button type="submit"
                  th:text="${usuario.id} != null ? 'üíæ Guardar cambios' : 'üíæ Crear usuario'"
                  class="btn btn-primary btn-custom"></button>
          <a th:href="@{/usuarios}" class="btn btn-secondary btn-custom">‚ùå Cancelar</a>
        </div>
      </form>

    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>